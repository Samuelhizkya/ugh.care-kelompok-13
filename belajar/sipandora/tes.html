<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Photo Booth Online</title>
    <style>
        body {
            font-family: 'Arial', sans-serif;
            background-color: #f0f0f0;
            margin: 0;
            padding: 20px;
            text-align: center;
        }
        
        h1 {
            color: #333;
        }
        
        .photo-booth-container {
            max-width: 800px;
            margin: 0 auto;
            background-color: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 0 10px rgba(0,0,0,0.1);
        }
        
        #camera-container {
            width: 100%;
            margin: 20px auto;
            position: relative;
        }
        
        #video {
            width: 100%;
            background-color: #ddd;
            border-radius: 5px;
        }
        
        #canvas {
            display: none;
            width: 100%;
            border-radius: 5px;
        }
        
        .controls {
            margin: 20px 0;
        }
        
        button {
            background-color: #4CAF50;
            color: white;
            border: none;
            padding: 10px 20px;
            margin: 5px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 16px;
            transition: background-color 0.3s;
        }
        
        button:hover {
            background-color: #45a049;
        }
        
        #capture-btn {
            background-color: #f44336;
        }
        
        #capture-btn:hover {
            background-color: #d32f2f;
        }
        
        #download-btn {
            background-color: #2196F3;
        }
        
        #download-btn:hover {
            background-color: #0b7dda;
        }
        
        .filter-options {
            display: flex;
            justify-content: center;
            flex-wrap: wrap;
            margin: 15px 0;
        }
        
        .filter-btn {
            width: 60px;
            height: 60px;
            margin: 5px;
            border-radius: 5px;
            cursor: pointer;
            border: 2px solid transparent;
        }
        
        .filter-btn.active {
            border-color: #4CAF50;
        }
        
        .gallery {
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            margin-top: 20px;
        }
        
        .gallery img {
            width: 100px;
            height: 100px;
            object-fit: cover;
            margin: 5px;
            border-radius: 5px;
            cursor: pointer;
        }
        
        #countdown {
            font-size: 48px;
            color: red;
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            display: none;
        }
    </style>
</head>
<body>
    <div class="photo-booth-container">
        <h1>Photo Booth Online</h1>
        <p>Ambil foto dengan gaya Anda sendiri!</p>
        
        <div class="controls">
            <button id="start-camera">Mulai Kamera</button>
            <button id="capture-btn">Ambil Foto</button>
            <button id="download-btn" disabled>Download Foto</button>
            <button id="retake-btn" disabled>Ulangi Foto</button>
        </div>
        
        <div class="filter-options">
            <div class="filter-btn active" data-filter="none" style="background: linear-gradient(135deg, #f5f7fa, #c3cfe2);"></div>
            <div class="filter-btn" data-filter="sepia" style="background: linear-gradient(135deg, #704214, #a78b71);"></div>
            <div class="filter-btn" data-filter="grayscale" style="background: linear-gradient(135deg, #bdc3c7, #2c3e50);"></div>
            <div class="filter-btn" data-filter="invert" style="background: linear-gradient(135deg, #000, #fff);"></div>
            <div class="filter-btn" data-filter="hue-rotate" style="background: linear-gradient(135deg, #ff00cc, #3333ff);"></div>
            <div class="filter-btn" data-filter="blur" style="background: linear-gradient(135deg, #e0e0e0, #a0a0a0);"></div>
        </div>
        
        <div id="camera-container">
            <video id="video" autoplay playsinline></video>
            <canvas id="canvas"></canvas>
            <div id="countdown">3</div>
        </div>
        
        <div class="gallery" id="gallery"></div>
    </div>

    <script>
        // Elemen DOM
        const video = document.getElementById('video');
        const canvas = document.getElementById('canvas');
        const startCameraBtn = document.getElementById('start-camera');
        const captureBtn = document.getElementById('capture-btn');
        const downloadBtn = document.getElementById('download-btn');
        const retakeBtn = document.getElementById('retake-btn');
        const filterBtns = document.querySelectorAll('.filter-btn');
        const gallery = document.getElementById('gallery');
        const countdown = document.getElementById('countdown');
        
        // Variabel global
        let stream = null;
        let currentFilter = 'none';
        
        // Mulai kamera
        startCameraBtn.addEventListener('click', async () => {
            try {
                stream = await navigator.mediaDevices.getUserMedia({ 
                    video: { 
                        width: { ideal: 1280 },
                        height: { ideal: 720 },
                        facingMode: 'user' 
                    }, 
                    audio: false 
                });
                video.srcObject = stream;
                startCameraBtn.disabled = true;
                captureBtn.disabled = false;
            } catch (err) {
                console.error("Error accessing camera: ", err);
                alert("Tidak dapat mengakses kamera. Pastikan Anda memberikan izin.");
            }
        });
        
        // Ambil foto
        captureBtn.addEventListener('click', () => {
            // Countdown sebelum mengambil foto
            let counter = 3;
            countdown.textContent = counter;
            countdown.style.display = 'block';
            
            const countdownInterval = setInterval(() => {
                counter--;
                countdown.textContent = counter;
                
                if (counter <= 0) {
                    clearInterval(countdownInterval);
                    countdown.style.display = 'none';
                    takePhoto();
                }
            }, 1000);
        });
        
        function takePhoto() {
            // Sesuaikan ukuran canvas dengan video
            canvas.width = video.videoWidth;
            canvas.height = video.videoHeight;
            
            // Gambar frame video ke canvas
            const context = canvas.getContext('2d');
            context.drawImage(video, 0, 0, canvas.width, canvas.height);
            
            // Terapkan filter
            applyFilter(context, currentFilter);
            
            // Tampilkan canvas dan sembunyikan video
            video.style.display = 'none';
            canvas.style.display = 'block';
            
            // Aktifkan tombol download dan retake
            downloadBtn.disabled = false;
            retakeBtn.disabled = false;
            captureBtn.disabled = true;
            
            // Tambahkan ke galeri
            addToGallery();
        }
        
        // Terapkan filter
        function applyFilter(context, filter) {
            switch(filter) {
                case 'sepia':
                    context.filter = 'sepia(100%)';
                    context.drawImage(canvas, 0, 0, canvas.width, canvas.height);
                    context.filter = 'none';
                    break;
                case 'grayscale':
                    context.filter = 'grayscale(100%)';
                    context.drawImage(canvas, 0, 0, canvas.width, canvas.height);
                    context.filter = 'none';
                    break;
                case 'invert':
                    context.filter = 'invert(100%)';
                    context.drawImage(canvas, 0, 0, canvas.width, canvas.height);
                    context.filter = 'none';
                    break;
                case 'hue-rotate':
                    context.filter = 'hue-rotate(90deg)';
                    context.drawImage(canvas, 0, 0, canvas.width, canvas.height);
                    context.filter = 'none';
                    break;
                case 'blur':
                    context.filter = 'blur(5px)';
                    context.drawImage(canvas, 0, 0, canvas.width, canvas.height);
                    context.filter = 'none';
                    break;
                default:
                    // Tidak ada filter
                    break;
            }
        }
        
        // Pilih filter
        filterBtns.forEach(btn => {
            btn.addEventListener('click', () => {
                filterBtns.forEach(b => b.classList.remove('active'));
                btn.classList.add('active');
                currentFilter = btn.dataset.filter;
            });
        });
        
        // Download foto
        downloadBtn.addEventListener('click', () => {
            const link = document.createElement('a');
            link.download = 'photo-booth-' + new Date().getTime() + '.png';
            link.href = canvas.toDataURL('image/png');
            link.click();
        });
        
        // Ulangi foto
        retakeBtn.addEventListener('click', () => {
            video.style.display = 'block';
            canvas.style.display = 'none';
            downloadBtn.disabled = true;
            retakeBtn.disabled = true;
            captureBtn.disabled = false;
        });
        
        // Tambahkan ke galeri
        function addToGallery() {
            const img = document.createElement('img');
            img.src = canvas.toDataURL('image/png');
            gallery.appendChild(img);
            
            // Klik gambar di galeri untuk melihat besar
            img.addEventListener('click', () => {
                const viewer = window.open('', '_blank');
                viewer.document.write(`<img src="${img.src}" style="max-width: 100%; height: auto;">`);
                viewer.document.close();
            });
        }
        
        // Hentikan kamera saat menutup halaman
        window.addEventListener('beforeunload', () => {
            if (stream) {
                stream.getTracks().forEach(track => track.stop());
            }
        });
    </script>
</body>
</html>